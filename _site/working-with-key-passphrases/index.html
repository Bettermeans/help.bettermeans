<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Help.Bettermeans - Working with SSH key passphrases</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" href="/css/print.css" type="text/css" media="print">
  </head>

  <body>
    
      <script type="text/javascript">var main_category = "setup"</script>
    
    <div id="main">
      <div id="header" class="basic">
        <div class="site">
          <div class="logo boring">
            <a href="/"><img src="/images/help.github.png" alt="bettermeans learn logo" /></a>
          </div>
          <div class="topsearch">
            <ul class="nav logged_out">
              <!-- <li><a href="http://gitref.org/">Git Reference</a></li>
              <li><a href="http://bettermeans.com/bettermeans/help.bettermeans.com#readme">Contribute</a></li>
              <li><a href="http://support.bettermeans.com/">Support</a></li> -->
              <li><a href="http://bettermeans.com/">Back to Bettermeans</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div id="content" class="site">
        <div id="guides">
          <div class="guide">
            <div class="main">
              <h1>Working with SSH key passphrases</h1>

              <div class="wikistyle">
                <p>This guide will step you through the process of securing your ssh keys while avoiding re-entry of your passphrase every time you use the key.</p>
<h2>Why do I need a passphrase?</h2>
<p>Passwords aren&#8217;t very secure, you already know this.  If you use one that&#8217;s easy to remember, it&#8217;s easier to guess or brute-force.  If you use one that&#8217;s random it&#8217;s hard to remember, and thus you&#8217;re more inclined to write the password down.  Both of these are Very Bad Things&trade;.  This is why you&#8217;re using ssh keys.</p>
<p>But using a key without a passphrase is basically the same as writing down that random password in a file on your computer.  Anyone who gains access to your drive has gained access to every system you use that key with.  This is also a Very Bad Thing&trade;.  The solution is obvious, add a passphrase.</p>
<h3>But I don&#8217;t want to enter a long passphrase every time I use the key!</h3>
<p>Neither do I!  Thankfully, there&#8217;s a nifty little tool called <code>ssh-agent</code> that can save your passphrase securely so you don&#8217;t have to re-enter it.  If you&#8217;re on <span class="caps">OSX</span> Leopard or later your keys can be saved in the system&#8217;s keychain to make your life even easier.  Most linux installations will automatically start <code>ssh-agent</code> for you when you log in.</p>
<h2>Adding or changing a passphrase</h2>
<p>Passphrases can be added to an existing key or changed without regenerating the keypair very easily:</p>
<pre class="terminal">$ ssh-keygen -p
Enter file in which the key is (/Users/tekkub/.ssh/id_rsa):
Key has comment '/Users/tekkub/.ssh/id_rsa'
Enter new passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved with the new passphrase.</pre>
<p>If your key already has a passphrase, you will be prompted to enter it before you can change to a new passphrase.</p>
<h2>Auto-launching ssh-agent on msysgit</h2>
<p>You can run <code>ssh-agent</code> automatically when you open bash by adding the following to your <code>~/.profile</code> or <code>~/.bashrc</code> file:</p>
<pre>
SSH_ENV="$HOME/.ssh/environment"

# start the ssh-agent
function start_agent {
    echo "Initializing new SSH agent..."
    # spawn ssh-agent
    ssh-agent | sed 's/^echo/#echo/' &gt; $SSH_ENV
    echo succeeded
    chmod 600 $SSH_ENV
    . $SSH_ENV &gt; /dev/null
    ssh-add
}

# test for identities
function test_identities {
    # test whether standard identities have been added to the agent already
    ssh-add -l | grep "The agent has no identities" &gt; /dev/null
    if [ $? -eq 0 ]; then
        ssh-add
        # $SSH_AUTH_SOCK broken so we start a new proper agent
        if [ $? -eq 2 ];then
            start_agent
        fi
    fi
}

# check for running ssh-agent with proper $SSH_AGENT_PID
ps -ef | grep $SSH_AGENT_PID | grep ssh-agent &gt; /dev/null
if [ $? -eq 0 ]; then
    test_identities
# if $SSH_AGENT_PID is not properly set, we might be able to load one from
# $SSH_ENV
else
    . $SSH_ENV &gt; /dev/null
    ps -ef | grep $SSH_AGENT_PID | grep ssh-agent &gt; /dev/null
    if [ $? -eq 0 ]; then
        test_identities
    else
        start_agent
    fi
fi
</pre>
<p style="padding-left:1em;"><strong>Note:</strong> If you don&#8217;t use the default key names, or store your keys in a different path, you will need to add the path to the <code>/usr/bin/ssh-add</code> line so that ssh knows where to find your key.</p>
<p>Now when you first run git bash, you will be prompted for your passphrase:</p>
<pre class="terminal">Initializing new SSH agent...
succeeded
Enter passphrase for /c/Users/Tekkub/.ssh/id_rsa:
Identity added: /c/Users/Tekkub/.ssh/id_rsa (/c/Users/Tekkub/.ssh/id_rsa)
Welcome to Git (version 1.6.0.2-preview20080923)


Run 'git help git' to display the help index.
Run 'git help &lt;command&gt;' to display help for specific commands.
[Tekkub@KAKU: ~ master]$</pre>
<p>The process will continue to run until you log out, shutdown or kill ssh-agent.  To kill the process, find its <span class="caps">PID</span> with <code>ps</code> then call <code>kill &lt;PID&gt;</code>:</p>
<pre class="terminal">[Tekkub@KAKU: ~ master]$ ps
        PID    PPID    PGID     WINPID  TTY  UID    STIME COMMAND
       3796       1    3796       3796    ?  500 18:07:43 /bin/ssh-agent
       2780       1    2780       2780  con  500 18:10:50 /bin/bash
       3400    2780    3400        784  con  500 18:13:31 /bin/ps
[Tekkub@KAKU: ~ master]$ kill 3796</pre>
<p style="padding-left:1em;"><em>This section was written with help from <a href="http://www.cygwin.com/ml/cygwin/2001-06/msg00537.html">this post</a>.</em></p>
<h2>Mac <span class="caps">OSX</span> Keychain</h2>
<p>If you are on <span class="caps">OSX</span> Leopard or later, ssh-agent is run automatically for you.  It will also integrate with the keychain, so you can unlock your keys with it.  This has some major advantages over a command-line based setup like protecting your input from being copied or spied upon by universal access or low-level keyboard routines.</p>
<p>The default key files (<code>.ssh/id_rsa</code>, <code>.ssh/id_dsa</code> and <code>.ssh/identity</code>) should be handled automatically.  If you have a key with a different name, you can add it with <code>ssh-add path/to/my_key</code></p>
<p style="padding-left:1em;"><em>Make sure that you&#8217;re using the default OS X ssh-add command and not one installed by macports or some other external source.</em></p>
<p>When you first try to use the key you will be prompted to enter your passphrase:</p>
<p><img src="/images/SecurityAgent.jpg" title="Keychain prompt" alt="Keychain prompt" /></p>
<p>If you choose to save the passphrase with your keychain, you won&#8217;t have to enter it again.  Instead you&#8217;ll simply need to unlock your keychain.</p>
<p style="padding-left:1em;"><em>This section was written with help from <a href="http://www.dribin.org/dave/blog/archives/2007/11/28/ssh_agent_leopard/">this guide</a>.  If you would like to use more paranoid keychain settings like locking after sleep, check out <a href="http://www.dribin.org/dave/blog/archives/2007/11/28/securing_ssh_agent/">this guide</a>.</em></p>
              </div>
            </div>

            <div class="sidebar">
              
                <h3>Getting started</h3>
                  <ul id="categories">
                    
                  </ul>
              
                <h3>Guides</h3>
                  <ul id="categories">
                    
                      
                        <li><a href="/voting" id="guides">Dashboard</a></li>
                      
                    
                  </ul>
              
                <h3>Faq</h3>
                  <ul id="categories">
                    
                  </ul>
              
                <h3>Popular</h3>
                  <ul id="categories">
                    
                      
                        <li><a href="/forking" id="popular">Forking a project</a></li>
                      
                    
                      
                        <li><a href="/key-setup-redirect" id="popular">Generating SSH keys</a></li>
                      
                    
                      
                        <li><a href="/troubleshooting-common-issues" id="popular">Common issues and questions</a></li>
                      
                    
                      
                        <li><a href="/troubleshooting-ssh" id="popular">Troubleshooting SSH issues</a></li>
                      
                    
                      
                        <li><a href="/git-email-settings" id="popular">Setting user name, email and GitHub token</a></li>
                      
                    
                      
                        <li><a href="/removing-sensitive-data" id="popular">Removing sensitive data</a></li>
                      
                    
                      
                        <li><a href="/voting" id="popular">Dashboard</a></li>
                      
                    
                  </ul>
              
            </div>
          </div>
        </div>
      </div>
      <div class="push"></div>
    </div>

    <div id="footer">
      <div class="site">

        <div class="info">
          <div class="links">
            <a href="http://bettermeans.org/front/?cat=3"><b>Blog</b></a> |
            <a href="http://bettermeans.org/front/?page_id=284">Contact</a> |
            <a href="http://twitter.com/bettermeans">Twitter</a> |
            <a href="http://bettermeans.com/front/user_agreement.html">Terms of Service</a> | 
            <a href="http://bettermeans.com/front/privacy.html">Privacy Policy</a>
          </div>
          <div class="company">
           &copy;&copy;
            2010
            Bettermeans LLC.
            <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/" rel="license">
            Creative Commons Attribution-Noncommercial-Share Alike 3.0 License</a>
           
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
